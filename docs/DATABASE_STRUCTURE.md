# Database Structure Documentation

## Overview
This document describes the database structure for the Timef√∏ring App, a time tracking application built with Spring Boot and Oracle Database.

## Database Schema

### Tables Overview
The application uses three main tables:
- `users` - User accounts and profiles
- `projects` - Projects for time tracking
- `time_entries` - Time entries registered by users on projects

## Table Specifications

### users Table
**Purpose**: Stores user account information and profiles

| Column | Type | Constraints | Description |
|--------|------|-------------|-------------|
| user_id | NUMBER | PRIMARY KEY, IDENTITY | Unique user identifier |
| navn | VARCHAR2(255) | | User's full name |
| email | VARCHAR2(255) | NOT NULL, UNIQUE | User's email address |
| mobil | VARCHAR2(20) | CHECK format | User's mobile number (Norwegian format) |
| status | VARCHAR2(50) | DEFAULT 'ACTIVE', CHECK values | User account status |
| created_date | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Creation timestamp |
| updated_date | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Last update timestamp |
| version | NUMBER | DEFAULT 1 | Optimistic locking version |

**Indexes**:
- `idx_users_email` on email
- `idx_users_navn` on navn  
- `idx_users_status` on status
- `idx_users_created_date` on created_date

**Constraints**:
- `uk_users_email` - Unique email addresses
- `ck_users_status` - Status must be one of: ACTIVE, INACTIVE, PENDING, SUSPENDED
- `ck_users_mobil_format` - Mobile number format validation (Norwegian)

### projects Table
**Purpose**: Stores project information for time tracking

| Column | Type | Constraints | Description |
|--------|------|-------------|-------------|
| project_id | NUMBER | PRIMARY KEY, IDENTITY | Unique project identifier |
| navn | VARCHAR2(255) | NOT NULL | Project name |
| beskrivelse | CLOB | | Detailed project description |
| aktiv | NUMBER(1) | DEFAULT 1, CHECK values | Active status (1=active, 0=inactive) |
| opprettet_dato | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Creation timestamp |
| sist_endret | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Last modification timestamp |
| bruker_id | NUMBER | NOT NULL, FOREIGN KEY | Reference to project owner |
| version | NUMBER | DEFAULT 1 | Optimistic locking version |

**Indexes**:
- `idx_projects_navn` on navn
- `idx_projects_aktiv` on aktiv
- `idx_projects_bruker_id` on bruker_id
- `idx_projects_opprettet_dato` on opprettet_dato

**Constraints**:
- `fk_projects_bruker_id` - Foreign key to users.user_id
- `ck_projects_aktiv` - Active status must be 0 or 1

### time_entries Table
**Purpose**: Stores time entries registered by users on projects

| Column | Type | Constraints | Description |
|--------|------|-------------|-------------|
| time_entry_id | NUMBER | PRIMARY KEY, IDENTITY | Unique time entry identifier |
| prosjekt_id | NUMBER | NOT NULL, FOREIGN KEY | Reference to project |
| bruker_id | NUMBER | NOT NULL, FOREIGN KEY | Reference to user |
| dato | DATE | NOT NULL, CHECK not future | Date when work was performed |
| timer | NUMBER(5,2) | NOT NULL, CHECK positive, CHECK max 24 | Hours worked (decimal, max 24) |
| kommentar | CLOB | | Comment or description of work |
| opprettet_dato | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Registration timestamp |
| sist_endret | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Last modification timestamp |
| version | NUMBER | DEFAULT 1 | Optimistic locking version |

**Indexes**:
- `idx_time_entries_prosjekt_id` on prosjekt_id
- `idx_time_entries_bruker_id` on bruker_id
- `idx_time_entries_dato` on dato
- `idx_time_entries_opprettet_dato` on opprettet_dato
- `idx_time_entries_bruker_dato` on (bruker_id, dato)
- `idx_time_entries_prosjekt_dato` on (prosjekt_id, dato)

**Constraints**:
- `fk_time_entries_prosjekt_id` - Foreign key to projects.project_id
- `fk_time_entries_bruker_id` - Foreign key to users.user_id
- `ck_time_entries_timer_positive` - Hours must be positive
- `ck_time_entries_timer_max` - Maximum 24 hours per entry
- `ck_time_entries_dato_not_future` - Date cannot be in the future
- `uk_time_entries_unique_day` - Unique constraint on (bruker_id, prosjekt_id, dato)

## Database Features

### Audit Fields
All tables include audit fields for tracking:
- Creation timestamp (`created_date`/`opprettet_dato`)
- Last modification timestamp (`updated_date`/`sist_endret`)
- Version number for optimistic locking (`version`)

### Automatic Triggers
Each table has triggers that automatically:
- Update the `sist_endret`/`updated_date` field on updates
- Increment the version number for optimistic locking

### Sequences
Identity columns use Oracle's GENERATED BY DEFAULT AS IDENTITY, with backup sequences:
- `users_seq` (starts at 1000)
- `projects_seq` (starts at 1000)  
- `time_entries_seq` (starts at 1000)

## Test Data
The V5 migration includes comprehensive test data:
- 4 test users with different statuses
- 5 test projects (active and inactive)
- Multiple time entries covering recent dates
- Demonstrates all relationships and constraints

## Migration Files
- `V1__Create_users_table.sql` - Initial users table
- `V2__Update_users_table_with_required_fields.sql` - Add Norwegian fields
- `V3__Create_projects_table.sql` - Projects table
- `V4__Create_time_entries_table.sql` - Time entries table
- `V5__Insert_test_data.sql` - Test data for development

## Usage Notes
- All table and column names use snake_case convention
- Norwegian field names are used as specified in requirements
- Foreign key relationships ensure data integrity
- Comprehensive indexing for query performance
- Check constraints ensure data validity
- Optimistic locking prevents concurrent update conflicts
